<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Completo - Messi Stats</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: white;
            border: 3px solid white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
        }

        .panel.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 0;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
        }

        .team-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .team-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-save {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.4);
        }

        .btn-cancel {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-cancel:hover {
            background: #edf2f7;
        }

        .btn-view {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .status {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: 500;
            text-align: center;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            display: block;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            display: block;
        }

        .status.info {
            background: #bee3f8;
            color: #2c5282;
            display: block;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid var(--color);
        }

        .summary-card.matches { --color: #3182ce; }
        .summary-card.goals { --color: #38a169; }
        .summary-card.assists { --color: #d69e2e; }
        .summary-card.titles { --color: #9f7aea; }

        .summary-label {
            font-size: 0.85rem;
            color: #718096;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ Editor Completo de EstadÃ­sticas</h1>
            <p class="subtitle">Edita todas las estadÃ­sticas de Messi en un solo lugar</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('totales')">ğŸ“Š Totales de Carrera</div>
            <div class="tab" onclick="showTab('barcelona')">ğŸ”´ğŸ”µ Barcelona</div>
            <div class="tab" onclick="showTab('psg')">ğŸ”´ğŸ”µ PSG</div>
            <div class="tab" onclick="showTab('inter')">ğŸ©·ğŸ–¤ Inter Miami</div>
            <div class="tab" onclick="showTab('argentina')">ğŸ‡¦ğŸ‡· Argentina</div>
        </div>

        <!-- PANEL TOTALES -->
        <div id="totales" class="panel active">
            <div class="section-title">ğŸ“Š EstadÃ­sticas Totales de Carrera</div>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>âš½ Partidos Jugados</label>
                    <input type="number" id="total-matches" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ Goles Anotados</label>
                    <input type="number" id="total-goals" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¤ Asistencias</label>
                    <input type="number" id="total-assists" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ† TÃ­tulos Ganados</label>
                    <input type="number" id="total-titles" placeholder="0">
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-save" onclick="saveData('totales', event)">
                    ğŸ’¾ Guardar Totales
                </button>
                <button class="btn btn-view" onclick="openPage()">
                    ğŸŒ Ver PÃ¡gina
                </button>
                <button class="btn btn-cancel" onclick="forcePageReload()">
                    ğŸ”„ Actualizar PÃ¡gina
                </button>
            </div>

            <div class="status" id="status-totales"></div>
        </div>

        <!-- PANEL BARCELONA -->
        <div id="barcelona" class="panel">
            <div class="team-header">
                <img src="../images/EscudoBar.png" alt="Barcelona" class="team-logo">
                <div class="team-name">FC Barcelona</div>
            </div>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>âš½ Partidos</label>
                    <input type="number" id="barcelona-matches" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ Goles</label>
                    <input type="number" id="barcelona-goals" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¤ Asistencias</label>
                    <input type="number" id="barcelona-assists" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ† TÃ­tulos</label>
                    <input type="number" id="barcelona-titles" placeholder="0">
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-save" onclick="saveData('barcelona', event)">
                    ğŸ’¾ Guardar Barcelona
                </button>
                <button type="button" class="btn btn-cancel" onclick="loadData()">
                    ğŸ”„ Recargar
                </button>
            </div>

            <div class="status" id="status-barcelona"></div>
        </div>

        <!-- PANEL PSG -->
        <div id="psg" class="panel">
            <div class="team-header">
                <img src="../images/EscudoPSG.png" alt="PSG" class="team-logo">
                <div class="team-name">Paris Saint-Germain</div>
            </div>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>âš½ Partidos</label>
                    <input type="number" id="psg-matches" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ Goles</label>
                    <input type="number" id="psg-goals" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¤ Asistencias</label>
                    <input type="number" id="psg-assists" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ† TÃ­tulos</label>
                    <input type="number" id="psg-titles" placeholder="0">
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-save" onclick="saveData('psg', event)">
                    ğŸ’¾ Guardar PSG
                </button>
                <button type="button" class="btn btn-cancel" onclick="loadData()">
                    ğŸ”„ Recargar
                </button>
            </div>

            <div class="status" id="status-psg"></div>
        </div>

        <!-- PANEL INTER MIAMI -->
        <div id="inter" class="panel">
            <div class="team-header">
                <img src="../images/EscudoInt.png" alt="Inter Miami" class="team-logo">
                <div class="team-name">Inter Miami CF</div>
            </div>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>âš½ Partidos</label>
                    <input type="number" id="inter-matches" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ Goles</label>
                    <input type="number" id="inter-goals" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¤ Asistencias</label>
                    <input type="number" id="inter-assists" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ† TÃ­tulos</label>
                    <input type="number" id="inter-titles" placeholder="0">
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-save" onclick="saveData('inter', event)">
                    ğŸ’¾ Guardar Inter Miami
                </button>
                <button type="button" class="btn btn-cancel" onclick="loadData()">
                    ğŸ”„ Recargar
                </button>
            </div>

            <div class="status" id="status-inter"></div>
        </div>

        <!-- PANEL ARGENTINA -->
        <div id="argentina" class="panel">
            <div class="team-header">
                <img src="../images/EscudoAFA.png" alt="Argentina" class="team-logo">
                <div class="team-name">SelecciÃ³n Argentina</div>
            </div>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>âš½ Partidos</label>
                    <input type="number" id="argentina-matches" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ Goles</label>
                    <input type="number" id="argentina-goals" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ¤ Asistencias</label>
                    <input type="number" id="argentina-assists" placeholder="0">
                </div>
                <div class="input-group">
                    <label>ğŸ† TÃ­tulos</label>
                    <input type="number" id="argentina-titles" placeholder="0">
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-save" onclick="saveData('argentina', event)">
                    ğŸ’¾ Guardar Argentina
                </button>
                <button type="button" class="btn btn-cancel" onclick="loadData()">
                    ğŸ”„ Recargar
                </button>
            </div>

            <div class="status" id="status-argentina"></div>
        </div>
    </div>

    <script>
        let allData = null;

        // Cargar datos al inicio
        window.addEventListener('load', () => {
            loadData();
        });

        // Cambiar de pestaÃ±a
        function showTab(tabName) {
            // Actualizar tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Actualizar paneles
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        // Cargar todos los datos
        async function loadData() {
            try {
                const response = await fetch('http://localhost:9000/api/stats?' + new Date().getTime());
                allData = await response.json();
                
                // TOTALES
                document.getElementById('total-matches').value = allData.career_totals.matches;
                document.getElementById('total-goals').value = allData.career_totals.goals;
                document.getElementById('total-assists').value = allData.career_totals.assists;
                document.getElementById('total-titles').value = allData.career_totals.titles;
                
                // BARCELONA
                document.getElementById('barcelona-matches').value = allData.teams.barcelona.matches;
                document.getElementById('barcelona-goals').value = allData.teams.barcelona.goals;
                document.getElementById('barcelona-assists').value = allData.teams.barcelona.assists;
                document.getElementById('barcelona-titles').value = allData.teams.barcelona.titles;
                
                // PSG
                document.getElementById('psg-matches').value = allData.teams.psg.matches;
                document.getElementById('psg-goals').value = allData.teams.psg.goals;
                document.getElementById('psg-assists').value = allData.teams.psg.assists;
                document.getElementById('psg-titles').value = allData.teams.psg.titles;
                
                // INTER MIAMI
                document.getElementById('inter-matches').value = allData.teams.inter_miami.matches;
                document.getElementById('inter-goals').value = allData.teams.inter_miami.goals;
                document.getElementById('inter-assists').value = allData.teams.inter_miami.assists;
                document.getElementById('inter-titles').value = allData.teams.inter_miami.titles;
                
                // ARGENTINA
                document.getElementById('argentina-matches').value = allData.teams.argentina.matches;
                document.getElementById('argentina-goals').value = allData.teams.argentina.goals;
                document.getElementById('argentina-assists').value = allData.teams.argentina.assists;
                document.getElementById('argentina-titles').value = allData.teams.argentina.titles;
                
            } catch (error) {
                console.error('Error al cargar datos:', error);
                showStatus('totales', 'error', 'âŒ Error al cargar datos del servidor');
            }
        }

        // Guardar datos
        async function saveData(section, event) {
            // Prevenir cualquier comportamiento por defecto
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('ğŸ” DEBUG: saveData ejecutÃ¡ndose para secciÃ³n:', section);
            console.log('ğŸ” DEBUG: NO debe abrir ventanas automÃ¡ticamente');
            let updateData = {};
            
            if (section === 'totales') {
                updateData = {
                    career_totals: {
                        matches: parseInt(document.getElementById('total-matches').value),
                        goals: parseInt(document.getElementById('total-goals').value),
                        assists: parseInt(document.getElementById('total-assists').value),
                        titles: parseInt(document.getElementById('total-titles').value)
                    }
                };
            } else {
                const teamKey = section === 'inter' ? 'inter_miami' : section;
                updateData = {
                    teams: {
                        [teamKey]: {
                            matches: parseInt(document.getElementById(`${section}-matches`).value),
                            goals: parseInt(document.getElementById(`${section}-goals`).value),
                            assists: parseInt(document.getElementById(`${section}-assists`).value),
                            titles: parseInt(document.getElementById(`${section}-titles`).value)
                        }
                    }
                };
            }
            
            showStatus(section, 'info', 'ğŸ’¾ Guardando cambios...');
            
            try {
                const response = await fetch('http://localhost:9000/api/update-full', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showStatus(section, 'success', 'âœ… Â¡Cambios guardados! Recargando vista...');
                    
                    // Recargar datos locales
                    setTimeout(() => {
                        loadData();
                    }, 1000);
                    
                    // NO abrir ventanas automÃ¡ticamente - solo guardar datos
                } else {
                    showStatus(section, 'error', 'âŒ Error al guardar. Verifica que el servidor estÃ© corriendo.');
                }
                
            } catch (error) {
                showStatus(section, 'error', 'âŒ Error de conexiÃ³n con el servidor');
                console.error(error);
            }
        }

        // Abrir pÃ¡gina principal
        function openPage() {
            window.messiStatsWindow = window.open('../professional_stats.html', 'messiStats');
        }

        // Forzar recarga de la pÃ¡gina principal
        function forcePageReload() {
            // Intentar comunicarse con la pÃ¡gina principal si estÃ¡ abierta
            try {
                if (window.messiStatsWindow && !window.messiStatsWindow.closed) {
                    window.messiStatsWindow.location.reload(true);
                    showStatus('totales', 'success', 'âœ… PÃ¡gina actualizada');
                } else {
                    // Si no hay ventana abierta, abrir una nueva
                    window.messiStatsWindow = window.open('../professional_stats.html', 'messiStats');
                    showStatus('totales', 'success', 'âœ… PÃ¡gina abierta');
                }
            } catch (e) {
                showStatus('totales', 'info', 'â„¹ï¸ No se pudo acceder a la pÃ¡gina principal');
            }
        }

        // Mostrar mensaje de estado
        function showStatus(section, type, message) {
            const status = document.getElementById(`status-${section}`);
            status.className = `status ${type}`;
            status.textContent = message;
            
            if (type !== 'info') {
                setTimeout(() => {
                    status.className = 'status';
                }, 4000);
            }
        }
    </script>
</body>
</html>
